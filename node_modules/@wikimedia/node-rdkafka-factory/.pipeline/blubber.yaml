version: v4
base: docker-registry.wikimedia.org/nodejs18-slim

variants:
  build:
    base: docker-registry.wikimedia.org/nodejs18-devel
    copies: [local]
    apt: { packages: [git, build-essential] }
    node:
      requirements: [package.json]
    runs:
      environment:
        LINK: g++
  test:
    includes: [build]
    apt: { packages: [ca-certificates] }
    entrypoint: [npm, test]
